// asadia2.js// JavaScript pour les textes// Javascript pur et dur // Gestion générale des envoi AJAX        function choixNavigateur() {  if (navigator.userAgent.indexOf('MSIE 6')!=-1) // IE 6  return new ActiveXObject('Microsoft.XMLHTTP');  // AJAX spécifique  else // Le reste du monde  return new XMLHttpRequest();  // AJAX (presque) universel}// jQuery$(document).ready(function() { // Attente du DOM   /*    // gestion des infobulles  $( document ).tooltip({      show: {                effect: "slideDown",      delay: 250      }    }); */    function fliptexte(formule)     {      var requete = choixNavigateur();      var doc = "testimage"+formule;      requete.open("post",doc,false);      requete.send(null);      var reponse = requete.responseText;      $('#photolesion').html(reponse);    };      // gestion du clic sur le lien d'une photo (class="clic")  $('.clic').on('click', function (e)    {      var image = $(this).attr('name');      var hauteurclic = this.offsetTop;      if (hauteurclic < 400) {       var y = 55+ "px";      }      else{        var y = hauteurclic-250 + "px";      }      fliptexte(image);      $('#photolesion').css('margin-top',y);            $("#imagette").click(function()        {       engrand(this)      });         });    // gestion des styles  // Par défaut : élégant  $('.adtitre0').removeClass('adtitre0f').removeClass('adtitre0c').addClass('adtitre0e');    $('.adtitre1').removeClass('adtitre1f').removeClass('adtitre1c').addClass('adtitre1e');    $('.adtitre2').removeClass('adtitre2f').removeClass('adtitre2c').addClass('adtitre2e');    $('.adtitre3').removeClass('adtitre3f').removeClass('adtitre3c').addClass('adtitre3e');        $('.description').removeClass('descriptionf').addClass('descriptione');    $('#elegant').attr('checked','checked')      // Elégant  $('#elegant').click(function(){    $('.adtitre0').removeClass('adtitre0f').removeClass('adtitre0c').addClass('adtitre0e');    $('.adtitre1').removeClass('adtitre1f').removeClass('adtitre1c').addClass('adtitre1e');    $('.adtitre2').removeClass('adtitre2f').removeClass('adtitre2c').addClass('adtitre2e');    $('.adtitre3').removeClass('adtitre3f').removeClass('adtitre3c').addClass('adtitre3e');        $('.description').removeClass('descriptionf').addClass('descriptione');      });    // Flashy  $('#flashy').click(function(){      $('.adtitre0').removeClass('adtitre0e').removeClass('adtitre0c').addClass('adtitre0f');      $('.adtitre1').removeClass('adtitre1e').removeClass('adtitre1c').addClass('adtitre1f');      $('.adtitre2').removeClass('adtitre2e').removeClass('adtitre2c').addClass('adtitre2f');      $('.adtitre3').removeClass('adtitre3e').removeClass('adtitre3c').addClass('adtitre3f');      $('.description').removeClass('descriptione').addClass('descriptionf');        });    // Classique  $('#classique').click(function(){       $('.adtitre0').removeClass('adtitre0e').removeClass('adtitre0f').addClass('adtitre0c');       $('.adtitre1').removeClass('adtitre1e').removeClass('adtitre1f').addClass('adtitre1c');       $('.adtitre2').removeClass('adtitre2e').removeClass('adtitre2f').addClass('adtitre2c');       $('.adtitre3').removeClass('adtitre3e').removeClass('adtitre3f').addClass('adtitre3c');       $('.description').removeClass('descriptionf').removeClass('descriptione');         });      // on cache toutes les description  $('.description').slideUp();    // On gère la visibilité partielle en bascule  $('[class*="adtitre"]') .click(function(){      $('#photolesion').html("");      var idt = '#'+this.id +"t";      var idi = '#'+this.id +"img";      if ($(idt).is(':visible'))      {       $(idt).slideUp(1000);       $(idi).attr('src','images/trianglebas.jpeg');      }      else      {       $(idt).slideDown(2000);       $(idi).attr('src','images/trianglehaut.jpeg');      }                 });    // On gère la visibilité globale en bascule  $('#titreLEC').click(function(){    $('.description').slideToggle();    });       /*  PHOTO EN GRAND  */   /* Création de la photo en grand de la lésion */    function engrand(lui){      var srcimage = $(lui).attr('src');      var numimage = srcimage.substring(7,12);      var largeurf = $(window).width(); /* Largeur de la fenetre du navigateur */      var hauteurf = $(window).height();/* Hauteur de la fenetre du navigateur */      var doc = 'Fafficheengrand'+numimage+"_"+largeurf+"_"+hauteurf;/* fabrication du message AJAX envoyé à 4D  */      var requete = choixNavigateur();/* envoi du message AJAX  à 4D  */      requete.open("post",doc,false);      requete.send(null); /* traitée par la méthode WebAfficheImageEnGrand de 4D  */            var reponse = requete.responseText;      window.open(reponse) /* Ouverture dans une nouvelle fenêtre */    }    /* GESTION DU SURVOL DES BOUTONS*/      $('.bouton').mouseover(function(){          var nomimagea = $(this).attr('src');         var nomimagen = nomimagea.replace('Repos','Actif');         $(this).attr('src',nomimagen);      })          /* GESTION DE LA FIN DE SURVOL DES BOUTONS */    $('.bouton').mouseout(function(){       var nomimagea = $(this).attr('src');      var nomimagen = nomimagea.replace('Actif','Repos');      $(this).attr('src',nomimagen);    })     /* AFFICHAGE DES PHOTOS LIEES  */    $('[id^="imagette"]').click(function(){          var numimagea = this.id.substring(8);  /* N° de la nouvelle image à afficher  */            /* Modification du titre de la page */        varancnum =  window.document.title.substring(8);        window.document.title = 'Photo n°'+numimagea;            /* Remplacement des attributs de diapo appelée par l'appelante */            var il = $('#photodia').width();        var ih =  $('#photodia').height();        $(this).removeClass("imagesuph");        $(this).removeClass("imagesupv");      if (il>ih) {        $(this).addClass("imagesuph");      }      else{         $(this).addClass("imagesupv");      }        $(this).attr('title',varancnum);/* title  */        $(this).attr('alt',varancnum);/* alt  */        $(this).attr('id',"imagette"+varancnum);/* id  */        $(this).attr('src',"images/"+varancnum+"is.jpg");/* source  */            /* Modification de l'image */        var srcimagea = 'images/'+numimagea+'.jpg';        $('#photodia').attr('src',srcimagea);              /* disparition des fleches */        $('[src*="images/fleche"]').hide();        $('#flechephotoengrand').attr('alt',"Placer les explications");           /* fermeture des commentaires */        $('#com').hide();        $('#fermeture').hide();    });         /*  Boutons d'affichage des commentaires        id se terminent toutes par "photoeg"    */      $('[id*="photoeg"]').click(function(){        var numdia = document.title.substring(8);        var type = $(this).attr('id');        var doc = 'metlesinfos'+ type.charAt(0)+numdia;                var requete = choixNavigateur();        requete.open("post",doc,false);        requete.send(null);        var reponse = requete.responseText;        $('#com').html(reponse);        $('#com').show();        $('#fermeture').show();      });        /* Redimensionnement  */       $('#resize').click(function(){        var wl = $(window).width(); /* Largeur de la fenetre du navigateur */        var wh = $(window).height();/* Hauteur de la fenetre du navigateur */        var il = $('#photodia').width();/* Largeur de l'image */        var ih = $('#photodia').height();/* Hauteur de l'image */                if (wl==il) { /* Non redimensionné  */         var newlargeuri = (wh*100/ih)+"%"          $('#photodia').attr("width",newlargeuri); /*  Attribution de la largeur de l'image*/        }        else{  /* Redimensionné  */          var newhauteuri = "100%"          $('#photodia').attr("width",newhauteuri); /*  Attribution de la largeur de l'image*/        }        $('[src*="images/fleche"]').hide();        $('#flechephotoengrand').attr('alt',"Placer les explications");        $('#flechephotoengrand').attr('title',"Placer les explications");        var srcbouton = srcbouton.replace('IconeNF','IconeF');        $('#flechephotoengrand').attr('src',srcbouton);       });        /* Fermeture du commentaire  */      $('#fermeture').click(function(){        $('#com').hide();        $('#fermeture').hide();      });       /*  Bouton affichage des flèches */   $('#flechephotoengrand').click(function(){    var titrebouton = $('#flechephotoengrand').attr('alt');    var srcbouton = $('#flechephotoengrand').attr('src');      if (titrebouton == "Placer les explications") {        var srcbouton = srcbouton.replace('IconeF','IconeNF')        $('#flechephotoengrand').attr('alt',"Enlever les flèches d'explication");        $('#flechephotoengrand').attr('title',"Enlever les flèches d'explication");        var numdia = document.title.substring(8);        var doc = "metlesfleches"+numdia;        var requete = choixNavigateur();        requete.open("post",doc,false);        requete.send(null);        var reponse = requete.responseText;        /*         réponse type         "flecheadroite.PNG;X;Y;commentaire$         flecheenbas.PNG;X;Y;commentaire$ ...        */               for (var i=1;i<5;i=i+1)         {        /* Traitement de la ligne */          var pos = reponse.indexOf('£');          var ligne = reponse.substring(0,pos);           // raccourcissement de la chaine          reponse = reponse.substring(pos+1);        /* type d'image */          var pos = ligne.indexOf(';');          var lasrc = 'images/'+ligne.substring(0,pos);          varcible = '#fleche'+i          $(varcible).attr('src',lasrc);        /* coordonnées */          var largeur = $('#photodia').width();          var hauteur = $('#photodia').height();          ligne = ligne.substring(pos+1);          var pos = ligne.indexOf(';');          var coordX =  ligne.substring(0,pos);          ligne = ligne.substring(pos+1);          var pos = ligne.indexOf(';');          var coordY =  ligne.substring(0,pos);          if (coordX+coordY=="") {            $(varcible).hide();          }          else{            var dX = 0;            var dY = 0;            switch (i) {                case 1 :                  dX =-35;                  dY=-14;                break;                              case 2 :                dX=-14;                dY=-35;                break;                              case 3 :                  dY=-14;                  break;                                case 4 :                  dX=-14;                  break;              }            $(varcible).show();            var haut = Math.round(hauteur*coordY)+dY;            var droite = Math.round(largeur*coordX) + dX;          /* déplacement */            $(varcible).css({              top: haut,              left: droite,            });          /* le commentaire */            var com = ligne.substring(pos+1);            $(varcible).attr('title',com);            $(varcible).attr('alt',com);          }        }      }      else{         $('[src*="images/fleche"]').hide();         $('#flechephotoengrand').attr('alt',"Placer les explications");         $('#flechephotoengrand').attr('title',"Placer les explications");         var srcbouton = srcbouton.replace('IconeNF','IconeF');      }      $('#flechephotoengrand').attr('src',srcbouton);    });          /* Retour d'image en grand  */    /*  Bouton quitter */      $('#quittephotoengrand').click(function(){         window.close();      });         } ); 