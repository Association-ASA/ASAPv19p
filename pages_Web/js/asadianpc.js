/*  asadianpc.js = script de la page de Ne Pas Confondre (npc)*/$(function() {  // Au chargement  $('#mdep').slideUp(); // cachons le mode d'emploi  initclicbacphoto() // initialisation du clic sur les CB des photos  initclicsurphoto()// initialisation du clic sur les photos  initviviblecomnpc() // cacher les commentaires des photos non cochées  $("#cborgane").attr("cheched",false);  // Décocher les CB Organe  $("#cbespece").attr("cheched",false);  // Décocher les CB espèces  $("#pumlesion").val("toutes");      // On gère la visibilité du mode d'emploi en bascule  $('#mdei').click(function(){    $('#mdep').slideToggle();    var flechehautbas =  $('#mdei').attr('src');    if (flechehautbas.indexOf("haut")>0) {      flechehautbas = flechehautbas.replace("haut","bas");    }    else{      flechehautbas = flechehautbas.replace("bas","haut");    }    $('#mdei').attr('src',flechehautbas);  });    // Gestion du PUM  $('#liste').change(function(){    var numdia = $('#liste').val();    var doc = "donneNPC"+numdia;    var requete = choixNavigateur();    requete.open("post",doc,false);    requete.send(null);    var reponse = requete.responseText;    var pos = reponse.indexOf(";");    $('#comdiapo').html(reponse.substring(0,(pos-1)));    var suite = reponse.substring((pos+1));    var pos = suite.indexOf("£");    var diapos = suite.substring(0,(pos-1));    var imagessel = suite.substring((pos+1));    $('#imagesdiapo').html(diapos);    $('#diapanier').html(imagessel);    initclicbacphoto();    initclicsurphoto();    initviviblecomnpc();    initclicpp()    /*    $('[id^="pptextenpc"]').click(function(){      initclicpp(this)    });    */    $("#cborgane").attr("checked",false);  // Décocher les CB Organe    $("#cbespece").attr("checked",false);  // Décocher les CB espèces    $("#pumlesion").val("toutes"); // Sélection du PUm des lésions  });    // gestion des cases à cocher organe et espèce  $('[id^="cb"]').change(function(){    var etatespece = $('#cbespece').is(':checked');    var etatorgane = $('#cborgane').is(':checked');    var nomlesion = $('#cbpumlesion').val();    var doc = 'ccorganesp' + etatespece + etatorgane +$('#liste').val()+" ";    $("#imagesdiapo :checked").each(function(index) {      var numdiacoche = this.id.substring(3);      var com = $('#ta'+numdiacoche).html();      doc = doc +numdiacoche+"/"+ com +"£";    });    doc = doc + nomlesion;    var requete = choixNavigateur();    requete.open("post",doc,false);    requete.send(null);    var reponse = requete.responseText;    $('#imagesdiapo').html(reponse);    initclicbacphoto();    initclicsurphoto();    initviviblecomnpc();    initclicpp()  });     // gestion des clic sur pp    initclicpp()     function initclicpp(){    $('[id^="pptxt"]').click(function(){      var numphoto = this.id.substring(38) ; // élimination de "pptxt" + ID de la XDonnées + "_"      var idcomphoto = '#ta'+numphoto;      var idxdonnees = this.id.substring(5,37);      var longidxdonnees = idxdonnees.length;      var doc = "donnetitle"+idxdonnees      var requete = choixNavigateur();      requete.open("post",doc,false);      requete.send(null);      var reponse = requete.responseText;      $(idcomphoto).val(reponse);    });  };      function initclicbacphoto(){    $('#imagesdiapo :checkbox').click(function(){      var idbloccom =  '#'+this.id.replace('bac','tnpc');      var idcom =  '#'+this.id.replace('bac','ta');      var idblocpp =  '#'+this.id.replace('bac','ppp');      var textenpc = $(idcom).html()      if ($(this).is(':checked')==true){        if (textenpc=="") {          var numdia = $('#liste').val();          var doc = 'tnpcdeuxles'+this.id+'_'+numdia;          var requete = choixNavigateur();          requete.open("post",doc,false);          requete.send(null);          var reponse = requete.responseText;          $(idcom).html(reponse)        }        $(idbloccom).fadeTo('fast',1);        $(idblocpp).fadeTo('fast',1);      }      else{        $(idbloccom).fadeTo('fast',0.01);        $(idblocpp).fadeTo('fast',0.01);      }      var candidate = '#'+this.id;      var panier = "";      var compteurcase = 0;      var oc = true       $('#imagesdiapo :checkbox').each(function(index) {        if (($(this).is(':checked')==true)  & (oc==true)){          compteurcase = compteurcase+1;          if (compteurcase>6)          {            $(candidate).attr("checked",false);            alert('Désolé, on ne peut sélectionner que 6 diapositives maximum');            oc = false;          }          else          {            panier=panier+' '+this.id.substring(3);           }        }      }) ;      if(oc)      {        $('#diapanier').html(panier);      }     });  }    function initviviblecomnpc(){    $('#imagesdiapo :checkbox').each(function(index) {      if (this.id.substring(0,3)==="bac" ) {        var idbloccom =  '#'+this.id.replace('bac','tnpc');        var idblocpp =  '#'+this.id.replace('bac','ppp');        if ($(this).is(':checked')==true) {          $(idbloccom).fadeTo('fast',1);          $(idblocpp).fadeTo('fast',1);        }        else        {          $(idbloccom).fadeTo('fast',0.01);          $(idblocpp).fadeTo('fast',0.01);        }      }    });  }      // Gestion des images en grand  window.onresize = function(){  /* disparition des fleches     $('[src*="images/fleche"]').hide();    $('#flechephotoengrand').attr('alt',"Placer les explications");    $('#flechephotoengrand').attr('title',"Placer les explications");    var srcbouton = srcbouton.replace('IconeNF','IconeF');    $('#flechephotoengrand').attr('src',srcbouton);    */  };   function initclicsurphoto(){    $('.photoasadia').click(function(){ /* gestion du clic de l'image de la lésion */        engrand(this);      });  }       /*  PHOTO EN GRAND  */     /* CREATION DE LA PHOTO EN GRAND*/      function engrand(lui){        var srcimage = $(lui).attr('src');        var numimage = srcimage.substring(7,12);        var largeurf = $(window).width(); /* Largeur de la fenetre du navigateur */        var hauteurf = $(window).height();/* Hauteur de la fenetre du navigateur */        var doc = "F"+'afficheengrand'+numimage+"_"+largeurf+"_"+hauteurf;/* fabrication du message AJAX envoyé à 4D  */        var requete = choixNavigateur();/* envoi du message AJAX  à 4D  */        requete.open("post",doc,false);        requete.send(null); /* traitée par la méthode WebAfficheImageEnGrand de 4D  */                var reponse = requete.responseText;        window.open(reponse) /* Ouverture dans une nouvelle fenêtre */      }          /* GESTION DU SURVOL DES BOUTONS*/      $('.bouton').mouseover(function(){          var nomimagea = $(this).attr('src');         var nomimagen = nomimagea.replace('Repos','Actif');         $(this).attr('src',nomimagen);      })          /* GESTION DE LA FIN DE SURVOL DES BOUTONS */      $('.bouton').mouseout(function(){         var nomimagea = $(this).attr('src');        var nomimagen = nomimagea.replace('Actif','Repos');        $(this).attr('src',nomimagen);      })     /* AFFICHAGE DES PHOTOS LIEES  */      $('[id^="imagette"]').click(function(){        var french = ($('#quittephotoengrand').attr('src')=="quitter");        var numimagea = this.id.substring(8);  /* N° de la nouvelle image à afficher  */                /* Modification du titre de la page */          varancnum =  window.document.title.substring(8);          window.document.title = 'Photo n°'+numimagea;                /* Remplacement des attributs de diapo appelée par l'appelante */                var il = $('#photodia').width();        var ih =  $('#photodia').height();        $(this).removeClass("imagesuph");        $(this).removeClass("imagesupv");        if (il>ih) {          $(this).addClass("imagesuph");        }        else{           $(this).addClass("imagesupv");        }        $(this).attr('title',varancnum);/* title  */        $(this).attr('alt',varancnum);/* alt  */        $(this).attr('id',"imagette"+varancnum);/* id  */        $(this).attr('src',"images/"+varancnum+"is.jpg");/* source  */               /* Modification de l'image */          var srcimagea = 'images/'+numimagea+'.jpg';          $('#photodia').attr('src',srcimagea);                  /* disparition des fleches */          $('[src*="images/fleche"]').hide();          $('#flechephotoengrand').attr('src',"images/IconeFleRepos.png");                         /* fermeture des commentaires */          $('#com').hide();          $('#fermeture').hide();      });                                                                                 /* CLIC SUR BOUTONS COMMENTAIRES (id se terminent toutes par "photoeg") */       $('[id*="photoeg"]').click(function(){        var french = ($('#quittephotoengrand').attr('title')=="Quitter");        var init = french?"F":"A";        var numdia = document.title.substring(8);        var type = $(this).attr('id');        var doc = init+'metlesinfos'+ type.charAt(0)+numdia;                var requete = choixNavigateur();        requete.open("post",doc,false);        requete.send(null);        var reponse = requete.responseText;        $('#com').html(reponse);        $('#com').show();        $('#fermeture').show();      });        /* REDIMENSIONNEMENT  */      $('#resize').click(function(){        var french = ($('#quittephotoengrand').attr('title')=="Quitter");        var wl = $(window).width(); /* Largeur de la fenetre du navigateur */        var wh = $(window).height();/* Hauteur de la fenetre du navigateur */        var il = $('#photodia').width();/* Largeur de l'image */        var ih = $('#photodia').height();/* Hauteur de l'image */                if (wl==il) { /* Non redimensionné  */         var newlargeuri = (wh*100/ih)+"%"          $('#photodia').attr("width",newlargeuri); /*  Attribution de la largeur de l'image*/          var ttlarge = french?"Occuper toute la largeur":"Full width";          $('#resize').attr("alt",ttlarge);          $('#resize').attr("title",ttlarge);          $('#resize').attr("src","Images/IconeEnlargeRepos.png");        }        else{  /* Redimensionné  */          var newhauteuri = "100%"          $('#photodia').attr("width",newhauteuri); /*  Attribution de la largeur de l'image*/          var tthaut = french?"Ajuster à la fenêtre":"Fit to window";           $('#resize').attr("alt",tthaut);          $('#resize').attr("title",tthaut);          $('#resize').attr("src","Images/IconeResizeRepos.png");        }        $('[src*="images/fleche"]').hide();        var metfleche = french?"Placer les explications":"Put explanations";        $('#flechephotoengrand').attr('alt',metfleche);        $('#flechephotoengrand').attr('title',metfleche);        var srcbouton = srcbouton.replace('IconeNF','IconeF');        $('#flechephotoengrand').attr('src',srcbouton);      });        /* FERMETURE D'UN COMMENTAIRE  */      $('#fermeture').click(function(){        $('#com').hide();        $('#fermeture').hide();      });        /*  METTRE ENLEVER LES FLECHES */     $('#flechephotoengrand').click(function(){      /* var titrebouton = $('#flechephotoengrand').attr('alt'); */      var french = ($('#quittephotoengrand').attr('title')=="Quitter");      var srcbouton = $('#flechephotoengrand').attr('src');        if (srcbouton.substring(0,15) == "images/IconeFle") {          var srcbouton = srcbouton.replace('IconeF','IconeNF')          var otefleche = french?"Enlever les flèches d'explication":"Remove explanation";          $('#flechephotoengrand').attr('alt',otefleche);          $('#flechephotoengrand').attr('title',otefleche);          var numdia = document.title.substring(8);          var doc = "metlesfleches"+numdia;          var requete = choixNavigateur();          requete.open("post",doc,false);          requete.send(null);          var reponse = requete.responseText;          /*           réponse type           "flecheadroite.PNG;X;Y;commentaire$           flecheenbas.PNG;X;Y;commentaire$ ...          */                   for (var i=1;i<5;i=i+1)           {          /* Traitement de la ligne */            var pos = reponse.indexOf('£');            var ligne = reponse.substring(0,pos);             // raccourcissement de la chaine            reponse = reponse.substring(pos+1);          /* type d'image */            var pos = ligne.indexOf(';');            var lasrc = 'images/'+ligne.substring(0,pos);            varcible = '#fleche'+i            $(varcible).attr('src',lasrc);          /* coordonnées */            var largeur = $('#photodia').width();            var hauteur = $('#photodia').height();            ligne = ligne.substring(pos+1);            var pos = ligne.indexOf(';');            var coordX =  ligne.substring(0,pos);            ligne = ligne.substring(pos+1);            var pos = ligne.indexOf(';');            var coordY =  ligne.substring(0,pos);            if (coordX+coordY=="") {              $(varcible).hide();            }            else{              var dX = 0;              var dY = 0;              switch (i) {                  case 1 :                    dX =-35;                    dY=-14;                  break;                                  case 2 :                  dX=-14;                  dY=-35;                  break;                                  case 3 :                    dY=-14;                    break;                                    case 4 :                    dX=-14;                    break;                }              $(varcible).show();              var haut = Math.round(hauteur*coordY)+dY;              var droite = Math.round(largeur*coordX) + dX;            /* déplacement */              $(varcible).css({                top: haut,                left: droite,              });            /* le commentaire */              var com = ligne.substring(pos+1);              $(varcible).attr('title',com);              $(varcible).attr('alt',com);            }          }        }        else{          $('[src*="images/fleche"]').hide();          var metfleche = french?"Placer les explications":"Put explanation";                   $('#flechephotoengrand').attr('alt',metfleche);          $('#flechephotoengrand').attr('title',metfleche);          var srcbouton = srcbouton.replace('IconeNF','IconeF');        }        $('#flechephotoengrand').attr('src',srcbouton);      });          /* RETOUR D'IMAGE EN GRAND  */    /*  Bouton quitter */      $('#quittephotoengrand').click(function(){         window.close();      });         });/* initialisation AJAX en fonction du navigateur */function choixNavigateur()  {   if (navigator.userAgent.indexOf('MSIE 6')!=-1)    return new ActiveXObject('Microsoft.XMLHTTP');   else   return new XMLHttpRequest();   }  