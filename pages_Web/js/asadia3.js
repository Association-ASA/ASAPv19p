// asadia3.js// JavaScript pour les listes// Javascript pur et dur // Gestion générale des envoi AJAX        function choixNavigateur() {  if (navigator.userAgent.indexOf('MSIE 6')!=-1) // IE 6  return new ActiveXObject('Microsoft.XMLHTTP');  // AJAX spécifique  else // Le reste du monde  return new XMLHttpRequest();  // AJAX (presque) universel}function findPos(obj){    var curleft = curtop = 0;    if (obj.offsetParent) {        curleft = obj.offsetLeft        curtop = obj.offsetTop        while (obj == obj.offsetParent) {            curleft += obj.offsetLeft            curtop += obj.offsetTop        }    }    return [curleft,curtop];}// jQuery$(document).ready(function() { // Attente du DOM    /*  actions intitial */    formatetb('#listelesion');    initclicdetaillesion();    initclicdetailmotif();     initclicdetailphoto();     var langue = ($('#flagA').attr('src')=="images/DrapeauF.gif")? "En":"Fr";    var nbtotal = $('#nbtotal').val();    var nbactuel = $('#nbactuel').val();      /* Saisie dans champ de recherche */    $("#cherchelesion").bind("keyup", function(){      var name = $("#cherchelesion").val();      if ((name.length>2)||(name.length==0))      {        var requete = choixNavigateur();/* envoi du message AJAX  à 4D  */        var trouve = ($('#flagA').attr('src')=="images/DrapeauF.gif")? "searcha":"cherche";        var indicationf = "Cliquer sur l'icône du détail pour obtenir le contenu de la lésion.";        var indicationa = "Click the icon detail of lesion you want to display the content. ";        var mde = ($('#flagA').attr('src')=="images/DrapeauF.gif")? indicationa:indicationf;        $('#ledetaillesion').html(mde);        var doc = trouve+name;        requete.open("post",doc,false);        requete.send(null); /* traitée par la méthode WebChercheLesion de 4D  */        var reponse = requete.responseText;        var pos = reponse.indexOf('£');        var nb = reponse.substring(0,pos);        reponse = reponse.substring(pos+1);        $('#nbactuel').val(nb);        affichetblesion(reponse,'#listelesion');        initclicdetaillesion();      }    });        $("#cherchemotif").bind("keyup", function(){      var name = $("#cherchemotif").val();      if ((name.length>2)||(name.length==0))      {        var requete = choixNavigateur();/* envoi du message AJAX  à 4D  */        var trouve = "motifcherche";        var doc = trouve+name;        requete.open("post",doc,false);        requete.send(null); /* traitée par la méthode WebChercheMotif de 4D  */        var reponse = requete.responseText;        var pos = reponse.indexOf('£');        var nb = reponse.substring(0,pos);        reponse = reponse.substring(pos+1);        $('#nbactuel').val(nb);        $('#ledetailmotif').html("Cliquer sur l'icône du détail pour obtenir le contenu du motif.");         affichetblesion(reponse,'#listemotif');        initclicdetailmotif();      }    });        $("#cherchephoto").bind("keyup", function(){      var name = $("#cherchephoto").val();      if ((name.length>2)||(name.length==0))      {        var requete = choixNavigateur();/* envoi du message AJAX  à 4D  */        var trouve = ($('#flagA').attr('src')=="images/DrapeauF.gif")? "find":"trou";        var doc = trouve+name;        requete.open("post",doc,false);        requete.send(null); /* traitée par la méthode WebChercheLesion de 4D  */        var reponse = requete.responseText;        var pos = reponse.indexOf('£');        var nb = reponse.substring(0,pos);        reponse = reponse.substring(pos+1);        $('#nbactuel').val(nb);        affichetblesion(reponse,'#listephoto');        initclicdetailphoto();      }    });        function  affichetblesion(reponse,liste){      $(liste).html(reponse);      formatetb(liste)    }        /*  Appel 4D et Affichage du tableau  */     $('#btnaffiche').click(function(){      var requete = choixNavigateur();/* envoi du message AJAX  à 4D  */      var doc = "aboulelistelesion"      requete.open("post",doc,false);      requete.send(null); /* traitée par la méthode aboulelistelesion de 4D  */      var reponse = requete.responseText;      affichetblesion(reponse,'#listelesion');    });        function initclicdetailmotif(){      $('[id^="motifdetail"').click(function(){        var requete = choixNavigateur();/* envoi du message AJAX  à 4D  */        var doc = this.id;        /*var haut = findPos(this);        var rect = this.getBoundingClientRect();        */        requete.open("post",doc,false);        requete.send(null); /* traitée par la méthode aboulelistelesion de 4D  */        var reponse = requete.responseText;        $('#ledetailmotif').html(reponse);        $('tr.TbCorpsL').removeClass('lignechoisie');/* noircit toutes les lignes  */        var ligne = '#'+doc.replace('motifdetail','ligne')        $(ligne).toggleClass('lignechoisie');/* rougit la ligne cliquée  */      });    }         function initclicdetaillesion(){      $('[id^="detail"').click(function(){        var requete = choixNavigateur();/* envoi du message AJAX  à 4D  */        var doc = this.id;        /*var haut = findPos(this);        var rect = this.getBoundingClientRect();        */        requete.open("post",doc,false);        requete.send(null); /* traitée par la méthode aboulelistelesion de 4D  */        var reponse = requete.responseText;        $('#ledetaillesion').html(reponse);        $('tr.TbCorpsL').removeClass('lignechoisie');/* noircit toutes les lignes  */        var ligne = '#'+doc.replace('detail','ligne')        $(ligne).toggleClass('lignechoisie');/* rougit la ligne cliquée  */      });    }            function initclicdetailphoto(){      $('[id^="diadetail"').click(function(){        var requete = choixNavigateur();/* envoi du message AJAX  à 4D  */        var doc = this.id;        requete.open("post",doc,false);        requete.send(null); /* traitée par la méthode aboulelistelesion de 4D  */        var reponse = requete.responseText;        $('#ledetailphoto').html(reponse);        $('tr.TbCorpsL').removeClass('lignechoisie');/* noircit toutes les lignes  */        var ligne = '#'+doc.replace('detail','ligne')        $(ligne).toggleClass('lignechoisie');/* rougit la ligne cliquée  */        initclicsurphoto()      });    }        function formatetb(liste){      var nbtotal = $('#nbtotal').val();      var nbactuel = $('#nbactuel').val();      if (liste == "#listemotif")        {          var quoinom = "motif";          var quoiid = "motif";          nbactuel =(nbactuel=="1")? 'un seul '+quoinom +" " : ' '+nbactuel+" "+quoinom+"s ";          var rien = "Désolé, aucune "+quoinom+" n'a la chaine \""+$("#cherche"+quoiid).val()+"\" dans les critères de recherche annoncés"          var surtotalde = "sur un total de ";        }      else      {        var langue = ($('#flagA').attr('src')=="images/DrapeauF.gif")? "En":"Fr";        var lesion = ($('#flagA').attr('src')=="images/DrapeauF.gif")? "lesion":"lésion";        var quoinom = (liste == "#listephoto") ? "photo" : lesion;        var quoiid = (liste == "#listephoto") ? "photo" : "lesion";        var quoinom = (liste == "#listemotif") ? "motif" : quoinom;        var quoiid = (liste == "#listemotif") ? "motif" : quoiid;        var rienf = "Désolé, aucune "+quoinom+" n'a la chaine \""+$("#cherche"+quoiid).val()+"\" dans les critères de recherche annoncés"        var riena = "Sorry, no "+quoinom+"s have the string \""+$("#cherche"+quoiid).val()+"\" in the announced criteria"        var rien = (langue=="Fr")? rienf : riena;        nbactuelf = (nbactuel=="1")? 'une seule '+quoinom : ' '+nbactuel+" "+quoinom+"s ";        nbactuela = (nbactuel=="1")? 'only one '+quoinom: ' '+nbactuel+" "+quoinom+"s ";        nbactuel = (langue=="Fr")? nbactuelf : nbactuela ;        var surtotalde = (langue=="Fr")? "sur un total de " : "out of a total of ";      }           $('#TbLes').dataTable(        {          "scrollY": "500px",          "scrollCollapse": true,          "paging": false,          "ordering": true,          "searching": false,          "language":          {              "sProcessing":     "Traitement en cours...",              "sSearch":         "Rechercher :",              "sLengthMenu":     "Afficher _MENU_ dossiers",              "sInfo":           nbactuel+ surtotalde +nbtotal,              /*              "sInfoEmpty":      "Affichage du dossier 0 à 0 sur 0 dossier",              */              "sInfoEmpty":      "",              "sInfoFiltered":   "(filtré de _MAX_ éléments au total)",              "sInfoPostFix":    "",              "sLoadingRecords": "Chargement en cours...",              "sZeroRecords":    "Aucun dossier à afficher",              "sEmptyTable":     rien,              "oPaginate": {                  "sFirst":      "Premier",                  "sPrevious":   "Précédent",                  "sNext":       "Suivant",                  "sLast":       "Dernier"              },              "oAria": {                  "sSortAscending":  ": activer pour trier la colonne par ordre croissant",                  "sSortDescending": ": activer pour trier la colonne par ordre décroissant"              }          }        }      );    }        /*GESTION DES PHOTOS*/      window.onresize = function(){  /* disparition des fleches */    $('[src*="images/fleche"]').hide();    $('#flechephotoengrand').attr('alt',"Placer les explications");    $('#flechephotoengrand').attr('title',"Placer les explications");    var srcbouton = srcbouton.replace('IconeNF','IconeF');    $('#flechephotoengrand').attr('src',srcbouton);  };   function initclicsurphoto(){    $('.photoasadia').click(function(){ /* gestion du clic de l'image de la lésion */        engrand(this);      });  }     /*  PHOTO EN GRAND  */     /* CREATION DE LA PHOTO EN GRAND*/      function engrand(lui){        var french = ($('#flagA').attr('src')=="images/DrapeauA.gif");        var init = french?"F":"A";        var srcimage = $(lui).attr('src');        var numimage = srcimage.substring(7,12);        var largeurf = $(window).width(); /* Largeur de la fenetre du navigateur */        var hauteurf = $(window).height();/* Hauteur de la fenetre du navigateur */        var doc = init+'afficheengrand'+numimage+"_"+largeurf+"_"+hauteurf;/* fabrication du message AJAX envoyé à 4D  */        var requete = choixNavigateur();/* envoi du message AJAX  à 4D  */        requete.open("post",doc,false);        requete.send(null); /* traitée par la méthode WebAfficheImageEnGrand de 4D  */                var reponse = requete.responseText;        window.open(reponse) /* Ouverture dans une nouvelle fenêtre */      }          /* GESTION DU SURVOL DES BOUTONS*/      $('.bouton').mouseover(function(){          var nomimagea = $(this).attr('src');         var nomimagen = nomimagea.replace('Repos','Actif');         $(this).attr('src',nomimagen);      })          /* GESTION DE LA FIN DE SURVOL DES BOUTONS */      $('.bouton').mouseout(function(){         var nomimagea = $(this).attr('src');        var nomimagen = nomimagea.replace('Actif','Repos');        $(this).attr('src',nomimagen);      })     /* AFFICHAGE DES PHOTOS LIEES  */      $('[id^="imagette"]').click(function(){        var french = ($('#quittephotoengrand').attr('src')=="quitter");        var numimagea = this.id.substring(8);  /* N° de la nouvelle image à afficher  */                /* Modification du titre de la page */          varancnum =  window.document.title.substring(8);          window.document.title = 'Photo n°'+numimagea;                /* Remplacement des attributs de diapo appelée par l'appelante */                var il = $('#photodia').width();        var ih =  $('#photodia').height();        $(this).removeClass("imagesuph");        $(this).removeClass("imagesupv");        if (il>ih) {          $(this).addClass("imagesuph");        }        else{           $(this).addClass("imagesupv");        }        $(this).attr('title',varancnum);/* title  */        $(this).attr('alt',varancnum);/* alt  */        $(this).attr('id',"imagette"+varancnum);/* id  */        $(this).attr('src',"images/"+varancnum+"is.jpg");/* source  */               /* Modification de l'image */          var srcimagea = 'images/'+numimagea+'.jpg';          $('#photodia').attr('src',srcimagea);                  /* disparition des fleches */          $('[src*="images/fleche"]').hide();          $('#flechephotoengrand').attr('src',"images/IconeFleRepos.png");                         /* fermeture des commentaires */          $('#com').hide();          $('#fermeture').hide();      });                                                                                 /* CLIC SUR BOUTONS COMMENTAIRES (id se terminent toutes par "photoeg") */       $('[id*="photoeg"]').click(function(){        var french = ($('#quittephotoengrand').attr('title')=="Quitter");        var init = french?"F":"A";        var numdia = document.title.substring(8);        var type = $(this).attr('id');        var doc = init+'metlesinfos'+ type.charAt(0)+numdia;                var requete = choixNavigateur();        requete.open("post",doc,false);        requete.send(null);        var reponse = requete.responseText;        $('#com').html(reponse);        $('#com').show();        $('#fermeture').show();      });        /* REDIMENSIONNEMENT  */      $('#resize').click(function(){        var french = ($('#quittephotoengrand').attr('title')=="Quitter");        var wl = $(window).width(); /* Largeur de la fenetre du navigateur */        var wh = $(window).height();/* Hauteur de la fenetre du navigateur */        var il = $('#photodia').width();/* Largeur de l'image */        var ih = $('#photodia').height();/* Hauteur de l'image */                if (wl==il) { /* Non redimensionné  */         var newlargeuri = (wh*100/ih)+"%"          $('#photodia').attr("width",newlargeuri); /*  Attribution de la largeur de l'image*/          var ttlarge = french?"Occuper toute la largeur":"Full width";          $('#resize').attr("alt",ttlarge);          $('#resize').attr("title",ttlarge);          $('#resize').attr("src","Images/IconeEnlargeRepos.png");        }        else{  /* Redimensionné  */          var newhauteuri = "100%"          $('#photodia').attr("width",newhauteuri); /*  Attribution de la largeur de l'image*/          var tthaut = french?"Ajuster à la fenêtre":"Fit to window";           $('#resize').attr("alt",tthaut);          $('#resize').attr("title",tthaut);          $('#resize').attr("src","Images/IconeResizeRepos.png");        }        $('[src*="images/fleche"]').hide();        var metfleche = french?"Placer les explications":"Put explanations";        $('#flechephotoengrand').attr('alt',metfleche);        $('#flechephotoengrand').attr('title',metfleche);        var srcbouton = srcbouton.replace('IconeNF','IconeF');        $('#flechephotoengrand').attr('src',srcbouton);      });        /* FERMETURE D'UN COMMENTAIRE  */      $('#fermeture').click(function(){        $('#com').hide();        $('#fermeture').hide();      });        /*  METTRE ENLEVER LES FLECHES */     $('#flechephotoengrand').click(function(){      /* var titrebouton = $('#flechephotoengrand').attr('alt'); */      var french = ($('#quittephotoengrand').attr('title')=="Quitter");      var anglais = french? "":"a";      var srcbouton = $('#flechephotoengrand').attr('src');        if (srcbouton.substring(0,15) == "images/IconeFle") {          var srcbouton = srcbouton.replace('IconeF','IconeNF')          var otefleche = french?"Enlever les flèches d'explication":"Remove explanation";          $('#flechephotoengrand').attr('alt',otefleche);          $('#flechephotoengrand').attr('title',otefleche);          var numdia = document.title.substring(8);          var doc = "metlesfleches" + numdia + anglais ;          var requete = choixNavigateur();          requete.open("post",doc,false);          requete.send(null);          var reponse = requete.responseText;          /*           réponse type           "flecheadroite.PNG;X;Y;commentaire$           flecheenbas.PNG;X;Y;commentaire$ ...          */                   for (var i=1;i<5;i=i+1)           {          /* Traitement de la ligne */            var pos = reponse.indexOf('£');            var ligne = reponse.substring(0,pos);             // raccourcissement de la chaine            reponse = reponse.substring(pos+1);          /* type d'image */            var pos = ligne.indexOf(';');            var lasrc = 'images/'+ligne.substring(0,pos);            varcible = '#fleche'+i            $(varcible).attr('src',lasrc);          /* coordonnées */            var largeur = $('#photodia').width();            var hauteur = $('#photodia').height();            ligne = ligne.substring(pos+1);            var pos = ligne.indexOf(';');            var coordX =  ligne.substring(0,pos);            ligne = ligne.substring(pos+1);            var pos = ligne.indexOf(';');            var coordY =  ligne.substring(0,pos);            if (coordX+coordY=="") {              $(varcible).hide();            }            else{              var dX = 0;              var dY = 0;              switch (i) {                  case 1 :                    dX =-35;                    dY=-14;                  break;                                  case 2 :                  dX=-14;                  dY=-35;                  break;                                  case 3 :                    dY=-14;                    break;                                    case 4 :                    dX=-14;                    break;                }              $(varcible).show();              var haut = Math.round(hauteur*coordY)+dY;              var droite = Math.round(largeur*coordX) + dX;            /* déplacement */              $(varcible).css({                top: haut,                left: droite,              });            /* le commentaire */              var com = ligne.substring(pos+1);              $(varcible).attr('title',com);              $(varcible).attr('alt',com);            }          }        }        else{          $('[src*="images/fleche"]').hide();          var metfleche = french?"Placer les explications":"Put explanation";                   $('#flechephotoengrand').attr('alt',metfleche);          $('#flechephotoengrand').attr('title',metfleche);          var srcbouton = srcbouton.replace('IconeNF','IconeF');        }        $('#flechephotoengrand').attr('src',srcbouton);      });          /* RETOUR D'IMAGE EN GRAND  */    /*  Bouton quitter */      $('#quittephotoengrand').click(function(){         window.close();      });     }); 