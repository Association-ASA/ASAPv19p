<!doctype html>
<html>
<head>
<title>4D merge view demo</title>
<meta charset="utf-8"/>

<link rel=stylesheet href="../lib/codemirror.css">
<link rel=stylesheet href="../addon/merge/merge.css">
<script src="../lib/codemirror.js"></script>
<script src="../addon/mode/loadmode.js"></script>
<script src="../mode/meta.js"></script>
<script src="../addon/merge/diff_match_patch.js"></script>
<script src="../addon/merge/merge.js"></script>
<script src="../addon/mode/multiplex.js"></script>
<script src="../addon/mode/overlay.js"></script>
<script src="../addon/mode/simple.js"></script>

<link rel="stylesheet" href="../addon/lint/lint.css" />
<link rel="stylesheet" href="../addon/hint/show-hint.css" />
<link rel="stylesheet" href="../addon/scroll/simplescrollbars.css" />
<link rel="stylesheet" href="../addon/dialog/dialog.css" />
<link rel="stylesheet" href="../addon/search/matchesonscrollbar.css" />

<script type="text/javascript" src="../lib/util/formatting.js"></script>
<script type="text/javascript" src="../addon/selection/selection-pointer.js"></script>
<script type="text/javascript" src="../addon/fold/foldcode.js"></script>
<script type="text/javascript" src="../addon/fold/foldgutter.js"></script>
<script type="text/javascript" src="../addon/fold/brace-fold.js"></script>
<script type="text/javascript" src="../addon/fold/xml-fold.js"></script>
<script type="text/javascript" src="../addon/fold/comment-fold.js"></script>
<script type="text/javascript" src="../addon/lint/jshint.js"></script>
<script type="text/javascript" src="../addon/lint/jsonlint.js"></script>
<script type="text/javascript" src="../addon/lint/csslint.js"></script>
<script type="text/javascript" src="../addon/lint/lint.js"></script>
<script type="text/javascript" src="../addon/lint/javascript-lint.js"></script>
<script type="text/javascript" src="../addon/lint/json-lint.js"></script>
<script type="text/javascript" src="../addon/lint/css-lint.js"></script>
<script type="text/javascript" src="../addon/hint/show-hint.js"></script>
<script type="text/javascript" src="../addon/hint/javascript-hint.js"></script>
<script type="text/javascript" src="../addon/scroll/simplescrollbars.js"></script>
<script type="text/javascript" src="../addon/dialog/dialog.js"></script>
<script type="text/javascript" src="../addon/search/searchcursor.js"></script>
<script type="text/javascript" src="../addon/search/search.js"></script>
<script type="text/javascript" src="../addon/scroll/annotatescrollbar.js"></script>
<script type="text/javascript" src="../addon/search/matchesonscrollbar.js"></script>
<script type="text/javascript" src="../addon/search/jump-to-line.js"></script>
<script type="text/javascript" src="../addon/edit/matchtags.js"></script>
<script type="text/javascript" src="../addon/edit/trailingspace.js"></script>
<script type="text/javascript" src="../addon/selection/active-line.js"></script>
<script type="text/javascript" src="../addon/edit/matchbrackets.js"></script>
<script type="text/javascript" src="../addon/edit/closebrackets.js"></script>
<script type="text/javascript" src="../addon/comment/comment.js"></script>
<script type="text/javascript" src="../addon/wrap/hardwrap.js"></script>
<script type="text/javascript" src="../keymap/sublime.js"></script>


<link rel="stylesheet" href="../addon/fold/foldgutter.css" />
<script src="../addon/fold/foldcode.js"></script>
<script src="../addon/fold/foldgutter.js"></script>
<script src="../addon/fold/brace-fold.js"></script>
<script src="../addon/fold/xml-fold.js"></script>
<script src="../addon/fold/indent-fold.js"></script>
<script src="../addon/fold/markdown-fold.js"></script>
<script src="../addon/fold/comment-fold.js"></script>

<style>
.CodeMirror { line-height: 1.2; }

.CodeMirror-dialog-top {
  opacity: 1 !important;
}

span.clicky {
  cursor: pointer;
  background: #d70;
  color: white;
  padding: 0 3px;
  border-radius: 5px;
  padding-bottom: 3px;
  padding-left: 8px;
  padding-right: 8px;
  padding-top: 3px;
  font-size: 13px;
  white-space: nowrap;
}

body, html { margin: 0; padding: 0; height: 100%; }
section, article { display: block; padding: 0; }

body {
  background: #f8f8f8;
  font-family: Helvetica, Arial, sans-serif;
  line-height: 1.5;
}

p { margin-top: 0; }

h2, h3, h1 {
  font-weight: normal;
  margin-bottom: .7em;
}
h1 { font-size: 140%; }
h2 { font-size: 120%; }
h3 { font-size: 110%; }
article > h2:first-child, section:first-child > h2 { margin-top: 0; }

#nav h1 {
  margin-right: 12px;
  margin-top: 0;
  margin-bottom: 2px;
  color: #d30707;
  letter-spacing: .5px;
}

a, a:visited, a:link, .quasilink {
  color: #A21313;
}

em {
  padding-right: 2px;
}

.quasilink {
  cursor: pointer;
}

article {
  max-width: 100%;
  margin: 0 0 0 0;
  border-left: 0px solid #E30808;
  border-right: 0px solid #ddd;
  padding-bottom: 16px;
  padding-left: 6px;
  padding-right: 16px;
  padding-top: 2px;
  background: white;
  z-index: 2;
  position: relative;
  min-height: 100%;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
}

#nav {
  position: fixed;
  padding-top: 30px;
  max-height: 100%;
  box-sizing: -moz-border-box;
  box-sizing: border-box;
  overflow-y: auto;
  left: 0; right: none;
  width: 160px;
  text-align: right;
  z-index: 1;
}

@media screen and (min-width: 1000px) {
  article {
    margin: 0 auto;
  }
  #nav {
    right: 50%;
    width: auto;
    border-right: 349px solid transparent;
  }
}

#nav ul {
  display: block;
  margin: 0; padding: 0;
  margin-bottom: 32px;
}

#nav a {
  text-decoration: none;
}

#nav li {
  display: block;
  margin-bottom: 4px;
}

#nav li ul {
  font-size: 80%;
  margin-bottom: 0;
  display: none;
}

#nav li.active ul {
  display: block;
}

#nav li li a {
  padding-right: 20px;
  display: inline-block;
}

#nav ul a {
  color: black;
  padding: 0 7px 1px 11px;
}

#nav ul a.active, #nav ul a:hover {
  border-bottom: 1px solid #E30808;
  margin-bottom: -1px;
  color: #E30808;
}

#logo {
  border: 0;
  margin-right: 12px;
  margin-bottom: 25px;
}

section {
  border-top: 1px solid #E30808;
  margin: 1.5em 0;
}

section.first {
  border: none;
  margin-top: 0;
}

#demo {
  position: relative;
}

#demolist {
  position: absolute;
  right: 5px;
  top: 5px;
  z-index: 25;
}

.yinyang {
  position: absolute;
  top: -10px;
  left: 0; right: 0;
  margin: auto;
  display: block;
  height: 120px;
}

.actions {
  margin: 1em 0 0;
  min-height: 100px;
  position: relative;
}

.actionspicture {
  pointer-events: none;
  position: absolute;
  height: 100px;
  top: 0; left: 0; right: 0;
}

.actionlink {
  pointer-events: auto;
  font-family: arial;
  font-size: 80%;
  font-weight: bold;
  position: absolute;
  top: 0; bottom: 0;
  line-height: 1;
  height: 1em;
  margin: auto;
}

.actionlink.download {
  color: white;
  right: 50%;
  margin-right: 13px;
  text-shadow: -1px 1px 3px #b00, -1px -1px 3px #b00, 1px 0px 3px #b00;
}

.actionlink.fund {
  color: #b00;
  left: 50%;
  margin-left: 15px;
}

.actionlink:hover {
  text-decoration: underline;
}

.actionlink a {
  color: inherit;
}

.actionsleft {
  float: left;
}

.actionsright {
  float: right;
  text-align: right;
}

@media screen and (max-width: 800px) {
  .actions {
    padding-top: 120px;
  }
  .actionsleft, .actionsright {
    float: none;
    text-align: left;
    margin-bottom: 1em;
  }
}

th {
  text-decoration: underline;
  font-weight: normal;
  text-align: left;
}

#features ul {
  list-style: none;
  margin: 0 0 1em;
  padding: 0 0 0 1.2em;
}

#features li:before {
  content: "-";
  width: 1em;
  display: inline-block;
  padding: 0;
  margin: 0;
  margin-left: -1em;
}

.rel {
  margin-bottom: 0;
}
.rel-note {
  margin-top: 0;
  color: #555;
}

pre {
  padding-left: 15px;
  border-left: 2px solid #ddd;
}

code {
  padding: 0 2px;
}

strong {
  text-decoration: underline;
  font-weight: normal;
}

.field {
  border: 1px solid #A21313;
}

*:not(.CodeMirror-merge-pane) > .CodeMirror,
.CodeMirror-merge.CodeMirror-merge-2pane,
.CodeMirror-merge.CodeMirror-merge-3pane {
  width: 100%;
  height: 100% !important;
  resize: none;
}
.CodeMirror-merge-2pane .CodeMirror-merge-pane,
.CodeMirror-merge-2pane .CodeMirror-merge-pane > div,
.CodeMirror-merge-3pane .CodeMirror-merge-pane,
.CodeMirror-merge-3pane .CodeMirror-merge-pane > div {
  height: 100% !important;
  resize: none;
}
  </style>
</head>
<body>
<article>
  <span style="margin-right: 20px; white-space: nowrap; font-size: 70%;"><select style="display:none;" id="myModeChooser" onchange="myChangeMode(this.selectedOptions[0].value)"></select></span>
  <span style="margin-right: 20px; white-space: nowrap; font-size: 70%;"><select style="display:none;" onchange="myChangeTheme(this.selectedOptions[0].value)" id="myThemeChooser">
    <option value="default">default</option>
    <option value="4d" selected>4D</option>
    </select></span>

    <span style="margin-right: 12px; white-space: nowrap; font-size: 12px; color: rgb(188, 188, 188); opacity: 0.3;" title="Ctrl-F / Cmd-F&#13;Start searching&#13;&#13;Ctrl-G / Cmd-G&#13;Find next&#13;&#13;Shift-Ctrl-G / Shift-Cmd-G&#13;Find previous&#13;&#13;Shift-Ctrl-F / Cmd-Option-F&#13;Replace&#13;&#13;Shift-Ctrl-R / Shift-Cmd-Option-F&#13;Replace all">&#128269;</span>
    <span style="margin-right: 12px; white-space: nowrap; font-size: 12px; color: rgb(188, 188, 188);" title="Alt-Left: goSubwordLeft&#13;Alt-Right: goSubwordRight&#13;Cmd-Up: scrollLineUp&#13;Cmd-Down: scrollLineDown&#13;Shift-Cmd-L: splitSelectionByLine&#13;Alt-Tab: indentLess&#13;Esc: singleSelectionTop&#13;Cmd-L: selectLine&#13;Shift-Cmd-K: deleteLine&#13;Cmd-Enter: insertLineAfter&#13;Shift-Cmd-Enter: insertLineBefore&#13;Cmd-D: selectNextOccurrence&#13;Shift-Cmd-Space: selectScope&#13;Shift-Cmd-M: selectBetweenBrackets&#13;Cmd-M: goToBracket&#13;Cmd-Ctrl-Up: swapLineUp&#13;Cmd-Ctrl-Down: swapLineDown&#13;Cmd-/: toggleComment&#13;Cmd-J: joinLines&#13;Ctrl-J: jumpToMatchingTag&#13;Shift-Cmd-D: duplicateLine&#13;Cmd-T: transposeChars&#13;F9: sortLines&#13;Cmd-F9: sortLinesInsensitive&#13;F2: nextBookmark&#13;Shift-F2: prevBookmark&#13;Cmd-F2: toggleBookmark&#13;Shift-Cmd-F2: clearBookmarks&#13;Alt-F2: selectBookmarks&#13;Alt-Q: wrapLines&#13;Cmd-K Cmd-Backspace: delLineLeft&#13;Backspace: smartBackspace&#13;Cmd-K Cmd-K: delLineRight&#13;Cmd-K Cmd-U: upcaseAtCursor&#13;Cmd-K Cmd-L: downcaseAtCursor&#13;Cmd-K Cmd-Space: setSublimeMark&#13;Cmd-K Cmd-A: selectToSublimeMark&#13;Cmd-K Cmd-W: deleteToSublimeMark&#13;Cmd-K Cmd-X: swapWithSublimeMark&#13;Cmd-K Cmd-Y: sublimeYank&#13;Cmd-K Cmd-G: clearBookmarks&#13;Cmd-K Cmd-C: showInCenter&#13;Shift-Alt-Up: selectLinesUpward&#13;Shift-Alt-Down: selectLinesDownward&#13;Cmd-F3: findUnder&#13;Shift-Cmd-F3: findUnderPrevious&#13;Ctrl-Q: fold&#13;Shift-Cmd-[: fold&#13;Shift-Cmd-]: unfold&#13;Cmd-K Cmd-j: unfoldAll&#13;Cmd-K Cmd-0: unfoldAll&#13;Cmd-H: replace">Keymap</span>
    <span style="margin-right: 12px; white-space: nowrap; font-size: 12px; color: rgb(188, 188, 188);">Shift-Tab=AutoIndent</span><span style="clear: both;"></span>
    <span style="margin-right: 12px; white-space: nowrap; font-size: 12px; color: rgb(188, 188, 188);">Alt-Tab=IndentLess</span><span style="clear: both;"></span>


<span style="font-size: 13px;"># Differences detected: <span id="myCountDiffs">0</span></span>&nbsp;
<span class="clicky" onclick="dv.edit.execCommand('goPrevDiff'); return false">&lt;&lt; previous diff</span>&nbsp;
<span class="clicky" onclick="dv.edit.execCommand('goNextDiff'); return false">next diff &gt;&gt;</span>&nbsp;
<span class="clicky" onclick="connect = connect ? null : 'align'; initUI()">align/pad changed sections</span>&nbsp;
<span class="clicky" onclick="collapse = !collapse; initUI()">collapse/expand unchanged</span>
</p>

<div id="view" style="display: block; min-width: 100%; clear: both; height: 490px; resize: vertical; overflow: auto; margin-right: 1px; background-color: rgba(255, 255, 255, 0.33); padding-bottom: 15px;" onmousemove="if(this.dataset.lastheight !== this.style.height) {this.dataset.lastheight = this.style.height; dv.edit.refresh(); dv.rightOriginal().refresh();}"></div>

<script>
var value, orig1, orig2, dv, panes = 2, highlight = true, connect = null, collapse = false;
function initUI() {
  if (value == null) return;
  var target = document.getElementById('view');
  target.innerHTML = '';
  if (dv) {
    if (dv.editor()) value = dv.editor().getValue();
    if (dv.leftOriginal()) orig1 = dv.leftOriginal().getValue();
    if (dv.rightOriginal()) orig2 = dv.rightOriginal().getValue();
  }
  dv = CodeMirror.MergeView(target, {
    value: value,
    origLeft: panes == 3 ? orig1 : null,
    orig: orig2,
    lineNumbers: true,
    lineWrapping: true,
    matchBrackets: true,
    mode: CodeMirror.findModeByName(document.getElementById('myModeChooser').selectedOptions[0].value).mime,
    theme: document.getElementById('myThemeChooser').selectedOptions[0].value,
    showTrailingSpace: true,
    selectionPointer: true,
    styleActiveLine: true,
    matchTags: {bothTags: true},
    highlightDifferences: highlight,
    connect: connect,
    collapseIdentical: collapse,
    allowEditingOriginals: true,
    keyMap: "sublime",
    indentUnit: 2,
    smartIndent: true,
    indentWithTabs: true,
    tabSize: 2,
    scrollbarStyle: "simple",
    foldGutter: {rangeFinder: new CodeMirror.fold.combine(CodeMirror.fold.indent, CodeMirror.fold.comment)},
    gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"]
  });
  dv.editor().on('change', function(cm, change) { setTimeout(function(){ myMergeViewOnChanged(cm, change); }, 255); });
  dv.rightOriginal().on('change', function(cm, change) { setTimeout(function(){ myMergeViewOnChanged(cm, change); }, 255); });  
}

function toggleDifferences() {
  dv.setShowDifferences(highlight = !highlight);
}

window.onload = function() {
  var i, myModes, myEl, myNewEl;
  myModes = CodeMirror.modeInfo.map(function(a) {return a.name;});
  myModes.sort();
  myEl = document.getElementById('myModeChooser');
  for (i = 0; i < myModes.length; i++) {
    newEl = document.createElement('option');
    newEl.setAttribute('value', myModes[i]);
    if (myModes[i] === '4d') newEl.setAttribute('selected', 'selected');
    newEl.innerHTML = myModes[i];
    myEl.appendChild(newEl);
  }

  value = " ";
  orig1 = value;
  orig2 = value;
  initUI();
  let d = document.createElement('div');
  d.style.cssText = 'width: 50px; margin: 7px; height: 14px';
  dv.editor().addLineWidget(57, d);
  set4dModeAndTheme();
};

function set4dModeAndTheme() {
  myChangeMode('4d');
  myChangeTheme('4d');
}

/*
function getDetects() {
  var myDocChilds, i, ii, iii, lastPos, aResult;
  aResult = [];
  myDocChilds = dv.edit.getDoc().children;
  for (i = 0; i < myDocChilds.length; i++) {
    for (ii = 0; ii < myDocChilds[i].lines.length; ii++) {
      lastPos=0;
      if (myDocChilds[i].lines[ii].styles) {
        for (iii = 1; iii < myDocChilds[i].lines[ii].styles.length; iii+=2) {
          if (myDocChilds[i].lines[ii].styles[iii+1]) {
            aResult.push({'key': myDocChilds[i].lines[ii].text.substring(lastPos, myDocChilds[i].lines[ii].styles[iii]), 'type': myDocChilds[i].lines[ii].styles[iii+1]});
          }
          lastPos=myDocChilds[i].lines[ii].styles[iii];
        }
      }
    }
  }
  return aResult;
}
*/

/* This is replaces the old-version of getDetects */
function getDetects(myEditorName) {
  var myDocChilds, i, ii, iii, lastPos, aResult;
  aResult = [];
  if ((!(myEditorName)) || (typeof myEditorName !== 'string')) return false;
  myEditorName = myEditorName.toLowerCase();
  if (myEditorName === 'css') {
      myDocChilds = editor2.getDoc().children;
  } else if (myEditorName === 'js') {
      myDocChilds = editor3.getDoc().children;
  } else if (myEditorName === 'json') {
      myDocChilds = editor4.getDoc().children;
  } else if (myEditorName === 'mergeleft') {
      myDocChilds = dv.edit.getDoc().children;
  } else if (myEditorName === 'mergeright') {
      myDocChilds = dv.rightOriginal().getDoc().children;
  } else if (myEditorName === 'html') {
      myDocChilds = editor1.getDoc().children;
  }
  for (i = 0; i < myDocChilds.length; i++) {
    for (ii = 0; ii < myDocChilds[i].lines.length; ii++) {
      lastPos=0;
      if (myDocChilds[i].lines[ii].styles) {
        for (iii = 1; iii < myDocChilds[i].lines[ii].styles.length; iii+=2) {
          if (myDocChilds[i].lines[ii].styles[iii+1]) {
            aResult.push({'key': myDocChilds[i].lines[ii].text.substring(lastPos, myDocChilds[i].lines[ii].styles[iii]), 'type': myDocChilds[i].lines[ii].styles[iii+1]});
          }
          lastPos=myDocChilds[i].lines[ii].styles[iii];
        }
      }
    }
  }
  return aResult;
}
/* This is NEW */
function myGoDocEnd(myEditorName) {
  if ((!(myEditorName)) || (typeof myEditorName !== 'string')) return false;
  myEditorName = myEditorName.toLowerCase();
  if (myEditorName === 'css') {
      CodeMirror.commands.goDocEnd(editor2);
  } else if (myEditorName === 'js') {
      CodeMirror.commands.goDocEnd(editor3);
  } else if (myEditorName === 'json') {
      CodeMirror.commands.goDocEnd(editor4);
  } else if (myEditorName === 'mergeleft') {
      CodeMirror.commands.goDocEnd(dv.edit);
  } else if (myEditorName === 'mergeright') {
      CodeMirror.commands.goDocEnd(dv.rightOriginal());
  } else if (myEditorName === 'html') {
      CodeMirror.commands.goDocEnd(editor1);
  }
}
function mergeViewHeight(mergeView) {
  function editorHeight(editor) {
    if (!editor) return 0;
    return editor.getScrollInfo().height;
  }
  return Math.max(editorHeight(mergeView.leftOriginal()),
                  editorHeight(mergeView.editor()),
                  editorHeight(mergeView.rightOriginal()));
}

function resize(mergeView) {
  var height = mergeViewHeight(mergeView);
  for(;;) {
    if (mergeView.leftOriginal())
      mergeView.leftOriginal().setSize(null, height);
    mergeView.editor().setSize(null, height);
    if (mergeView.rightOriginal())
      mergeView.rightOriginal().setSize(null, height);

    var newHeight = mergeViewHeight(mergeView);
    if (newHeight >= height) break;
    else height = newHeight;
  }
  mergeView.wrap.style.height = height + 'px';
}
</script>

<script>
function myChangeMode(myModeName) {
  var m, mode, spec;
  if (CodeMirror.findModeByName(myModeName)) {
    var info = CodeMirror.findModeByName(myModeName);
    if (info) {
      mode = info.mode;
      spec = myModeName;
    }
  } else if (m = /.+\.([^.]+)$/.exec(myModeName)) {
    var info = CodeMirror.findModeByExtension(m[1]);
    if (info) {
      mode = info.mode;
      spec = info.mime;
    }
  } else if (/\//.test(myModeName)) {
    var info = CodeMirror.findModeByMIME(myModeName);
    if (info) {
      mode = info.mode;
      spec = myModeName;
    }
  } else {
    mode = spec = myModeName;
  }
  if (mode) {
    if (dv.editor()) {
      dv.editor().setOption('mode', spec);
      CodeMirror.autoLoadMode(dv.editor(), mode);
    }
    if (dv.leftOriginal()) {
      dv.leftOriginal().setOption('mode', spec);
      CodeMirror.autoLoadMode(dv.leftOriginal(), mode);
    }
    if (dv.rightOriginal()) {
      dv.rightOriginal().setOption('mode', spec);
      CodeMirror.autoLoadMode(dv.rightOriginal(), mode);
    }
    setTimeout(function(){ initUI(); }, 255)
  } else {
    alert('Could not find a mode corresponding to ' + myModeName);
  }
}

function myMergeViewOnChanged (myCm, myChange) {
  var i, myElLeft, myElRight, myLast, myNext;
  document.getElementById('myCountDiffs').innerHTML = String(dv.rightChunks().length);
  myElLeft = document.getElementById('myDiffsLeft');
  if (!myElLeft) return false;
myElRight = document.getElementById('myDiffsRight');
  if (!myElRight) return false;
 myElLeft.innerHTML = '';
  myElRight.innerHTML = '';
  myLast = 0;
  myNext = 0;
  for (i = 0; i < dv.right.diff.length; i++) {
    if (dv.right.diff[i][0] === 1) {
      myElLeft.textContent += dv.right.diff[i][1] + '\n';
    } else if (dv.right.diff[i][0] === -1) {
      myElRight.textContent += dv.right.diff[i][1] + '\n';
    } else if (i < (dv.right.diff.length - 1)) {
      myNext = dv.right.diff[i+1][0];
      if (myNext === 1) {
        myElRight.textContent += '\n' + dv.right.diff[i+1][1].replace(/[^\n]/g, '');
      } else {
        myElLeft.textContent += '\n' + dv.right.diff[i+1][1].replace(/[^\n]/g, '');
      }
    }
    myLast = dv.right.diff[i][0];
  }
}
</script>
<script>
  function myChangeThemeSet(myThemeName) {
    if (dv.editor()) {
      dv.editor().setOption('theme', myThemeName);
    }
    if (dv.leftOriginal()) {
      dv.leftOriginal().setOption('theme', myThemeName);
    }
    if (dv.rightOriginal()) {
      dv.rightOriginal().setOption('theme', myThemeName);
    }
    setTimeout(function(){ initUI(); }, 255)
  }
  
  function myChangeTheme(myThemeName) {
    if (myThemeName === 'default') {
      myChangeThemeSet(myThemeName);
      return;
    }
    var link = document.createElement('link');
    link.onload = function() { myChangeThemeSet(myThemeName); };
    link.rel = 'stylesheet';
    link.media = 'all';
    link.href = '../theme/' + myThemeName.replace('solarized dark', 'solarized').replace('solarized light', 'solarized') + '.css';
    document.getElementsByTagName('head')[0].appendChild(link);
  }
</script>

<script>
      /* ----------------------------------
       * replaceAnyTextFragments Version 0.1
       * Funktion zum Ersetzen von Anzeige-Texten
       * Einschraenkung: Die Funktion nutzt rekursiven Aufruf, somit darf die DOM-Struktur nicht tiefer verschachtelt sein als die JS-Engine verschachtelte Aufrufe haendeln kann!
       */
      function replaceTextFragments(myEl, myOldTxt, myNewTxt) {
        var myOldTxtExp = RegExp(String(myOldTxt).replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1'), 'g');
        if ((myEl.tagName !== "SCRIPT") && (myEl.tagName !== "STYLE") && (myEl.tagName !== "NOSCRIPT") && (myEl = myEl.firstChild)) do {
          replaceTextFragments(myEl, myOldTxt, myNewTxt);
          if ((myEl.nodeType === 3) && (myEl.nodeValue.match(myOldTxtExp))) {
            myEl.nodeValue = myEl.nodeValue.replace(myOldTxtExp, myNewTxt);
          }
        } while ((myEl = myEl.nextSibling));
      }
      
      function insertAnyStyles(myCSS, myID) {
        var myHead, myStyleNode;
        myHead = document.head || document.getElementsByTagName('head')[0];
        myStyleNode = document.createElement('style');
        myStyleNode.setAttribute("type", "text/css");
        if ((typeof myID === 'string') && (myID.length > 1)) {
          myStyleNode.setAttribute("id", myID);
        }
        if (myStyleNode.styleSheet) {
          myStyleNode.styleSheet.cssText = myCSS;  /* for IE */
        } else if (typeof myStyleNode.textContent === 'string') {
          myStyleNode.textContent = myCSS;
        } else {
          myStyleNode.appendChild(document.createTextNode(myCSS));
        }
        myHead.appendChild(myStyleNode);
      }

      function setBodyBGColor(myBGColor) {
        if ((!(myBGColor)) || (typeof myBGColor !== 'string')) return false;
        document.body.style.backgroundColor = myBGColor;
      }

      function insertInEditor(myEditorName, mySrc) {
        if ((!(myEditorName)) || (typeof myEditorName !== 'string')) return false;
        myEditorName = myEditorName.toLowerCase();
        if (myEditorName === 'mergeleft') {
          dv.edit.setValue(mySrc);
        } else if (myEditorName === 'mergeright') {
          dv.rightOriginal().setValue(mySrc);
        } else if (myEditorName === 'mergeleft3') {
          if (dv.leftOriginal()) dv.leftOriginal().setValue(mySrc);
        }
      }

      function setEditorHeight(myEditorName, myHeight, myDiff) {
        if ((!(myEditorName)) || (typeof myEditorName !== 'string')) return false;
        myEditorName = myEditorName.toLowerCase();
        if ((!(myHeight)) || (typeof myHeight !== 'string')) myHeight = 'calc';
        if ((!(myDiff)) || (typeof myDiff !== 'string'))  {
          myDiff = 15;
        } else {
          myDiff = parseInt(myDiff, 10);
          if (isNaN(myDiff)) myDiff = 15;
        }
        if (myEditorName === 'merge') {
          if (myHeight === 'calc') {
            document.getElementById('box_editorsMerge').style.height = 'calc(100vh - ' + (document.getElementById('box_editorsMerge').offsetTop + myDiff) + 'px)';
          } else {
            document.getElementById('box_editorsMerge').style.height = myHeight;
            if ((myHeight === 'auto') || (myHeight.indexOf('%') > 0)) {
              dv.edit.refresh();
              dv.rightOriginal().refresh();
              document.getElementById('box_editorsMerge').style.height = (document.getElementById('box_editorsMerge').offsetHeight - myDiff) + 'px';
            }
          }
          dv.edit.refresh();
          dv.rightOriginal().refresh();
        }
      }
/* ========= /2/lib/util/formatting.js ========= */
/* ======
var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
lineNumbers: true,
mode: "htmlmixed"
});
CodeMirror.commands["selectAll"](editor);
====== */
function getSelectedRange(myEditor) {
  return { from: myEditor.getCursor(true), to: myEditor.getCursor(false) };
}
function getAllRange(myEditor) {
  return { from: myEditor.posFromIndex(0), to: myEditor.posFromIndex() };
}
function autoFormatSelection(myEditor) {
  var range = getSelectedRange(myEditor);
  myEditor.autoFormatRange(range.from, range.to);
}
function autoFormatAll(myEditor) {
  var range = getAllRange(myEditor);
  myEditor.autoFormatRange(range.from, range.to);
}
function commentSelection(myEditor, isComment) {
  var range = getSelectedRange(myEditor);
  myEditor.commentRange(isComment, range.from, range.to);
}
/* ============================================ */

function setMyEditorOpt(myEditor, mySel) {
  var myI;
  for (myI = 0; myI < myEditor.length; myI++) {
    if (mySel.value === 'LWon') {
      myEditor[myI].setOption('lineWrapping', true);
    } else if (mySel.value === 'LWoff') {
      myEditor[myI].setOption('lineWrapping', true);
    } else if (mySel.value === 'STSon') {
      myEditor[myI].setOption('showTrailingSpace', true);
    } else if (mySel.value === 'STSoff') {
      myEditor[myI].setOption('showTrailingSpace', false);
    } else if (mySel.value === 'MODEmixed') {
      myEditor[myI].setOption('mode', mixedMode);
      myEditor[myI].setOption('matchTags', {bothTags: true});
      myEditor[myI].setOption('showTrailingSpace', true);
      myEditor[myI].setOption('selectionPointer', true);
      myEditor[myI].setOption('styleActiveLine', true);
      myEditor[myI].setOption('lineNumbers', true);
      myEditor[myI].setOption('lineWrapping', false);
      myEditor[myI].setOption('extraKeys', {'Ctrl-Q': function(cm){ cm.foldCode(cm.getCursor()); }, 'Ctrl-Space': 'autocomplete', "Ctrl-J": "toMatchingTag"});
      myEditor[myI].setOption('foldGutter', true);
      myEditor[myI].setOption('gutters', ['CodeMirror-linenumbers', 'CodeMirror-foldgutter']);
      myEditor[myI].setOption('indentUnit', 2);
      myEditor[myI].setOption('smartIndent', true);
      myEditor[myI].setOption('indentWithTabs', false);
      myEditor[myI].setOption('tabSize', 2);
      myEditor[myI].setOption('scrollbarStyle', 'simple');
    } else if (mySel.value === 'MODEcss') {
      myEditor[myI].setOption('mode', 'css');
      myEditor[myI].setOption('showTrailingSpace', true);
      myEditor[myI].setOption('styleActiveLine', true);
      myEditor[myI].setOption('lineNumbers', true);
      myEditor[myI].setOption('lineWrapping', true);
      myEditor[myI].setOption('extraKeys', {"Ctrl-Q": function(cm){ cm.foldCode(cm.getCursor()); }, "Ctrl-Space": "autocomplete"});
      myEditor[myI].setOption('foldGutter', true);
      myEditor[myI].setOption('gutters', ["CodeMirror-linenumbers", "CodeMirror-foldgutter", "CodeMirror-lint-markers"]);
      myEditor[myI].setOption('indentUnit', 2);
      myEditor[myI].setOption('smartIndent', true);
      myEditor[myI].setOption('indentWithTabs', false);
      myEditor[myI].setOption('tabSize', 2);
      myEditor[myI].setOption('lint', true);
      myEditor[myI].setOption('scrollbarStyle', "simple");
    } else if (mySel.value === 'MODEjs') {
      myEditor[myI].setOption('mode', {name: 'javascript', globalVars: true});
      myEditor[myI].setOption('showTrailingSpace', true);
      myEditor[myI].setOption('styleActiveLine', true);
      myEditor[myI].setOption('lineNumbers', true);
      myEditor[myI].setOption('lineWrapping', true);
      myEditor[myI].setOption('extraKeys', {"Ctrl-Q": function(cm){ cm.foldCode(cm.getCursor()); }, "Ctrl-Space": "autocomplete"});
      myEditor[myI].setOption('keyMap', "sublime");
      myEditor[myI].setOption('matchBrackets', true);
      myEditor[myI].setOption('foldGutter', true);
      myEditor[myI].setOption('gutters', ["CodeMirror-linenumbers", "CodeMirror-foldgutter", "CodeMirror-lint-markers"]);
      myEditor[myI].setOption('indentUnit', 2);
      myEditor[myI].setOption('smartIndent', true);
      myEditor[myI].setOption('indentWithTabs', false);
      myEditor[myI].setOption('tabSize', 2);
      myEditor[myI].setOption('electricChars', true);
      myEditor[myI].setOption('lint', true);
      myEditor[myI].setOption('scrollbarStyle', "simple");
    } else if (mySel.value === 'MODEjson') {
      myEditor[myI].setOption('mode', 'application/json');
      myEditor[myI].setOption('showTrailingSpace', true);
      myEditor[myI].setOption('styleActiveLine', true);
      myEditor[myI].setOption('lineNumbers', true);
      myEditor[myI].setOption('lineWrapping', true);
      myEditor[myI].setOption('extraKeys', {"Ctrl-Q": function(cm){ cm.foldCode(cm.getCursor()); }});
      myEditor[myI].setOption('foldGutter', true);
      myEditor[myI].setOption('gutters', ["CodeMirror-linenumbers", "CodeMirror-foldgutter", "CodeMirror-lint-markers"]);
      myEditor[myI].setOption('completeSingle', false);
      myEditor[myI].setOption('indentUnit', 2);
      myEditor[myI].setOption('smartIndent', true);
      myEditor[myI].setOption('indentWithTabs', false);
      myEditor[myI].setOption('tabSize', 2);
      myEditor[myI].setOption('lint', true);
      myEditor[myI].setOption('scrollbarStyle', "simple");
    } else if (mySel.value === 'MODEhtml') {
      myEditor[myI].setOption('mode', 'text/html');
      myEditor[myI].setOption('showTrailingSpace', true);
      myEditor[myI].setOption('selectionPointer', true);
      myEditor[myI].setOption('styleActiveLine', true);
      myEditor[myI].setOption('lineNumbers', true);
      myEditor[myI].setOption('lineWrapping', false);
      myEditor[myI].setOption('matchTags', {bothTags: true});
      myEditor[myI].setOption('indentUnit', 2);
      myEditor[myI].setOption('smartIndent', true);
      myEditor[myI].setOption('indentWithTabs', false);
      myEditor[myI].setOption('tabSize', 2);
      myEditor[myI].setOption('scrollbarStyle', "simple");
    } else {
      // ignore
    }
  }
  mySel.options[0].selected = true;
}

function setSpecials(myEditor, mySel) {
  var myI;
  for (myI = 0; myI < myEditor.length; myI++) {
    if (mySel.value === 'MiniLeft') {
      if (myI === 0) {
        miniEditor(myEditor[myI]);
      }
    } else if (mySel.value === 'MiniRight') {
      if (myI === 1) {
        miniEditor(myEditor[myI]);
      }
    } else if (mySel.value === 'MiniBoth') {
      miniEditor(myEditor[myI]);
    } else if (mySel.value === 'ReparseLeft') {
      if (myI === 0) {
        myEditor[myI].setValue(new XMLSerializer().serializeToString(new DOMParser().parseFromString(myEditor[myI].getValue(), 'text/html')).replace(' xmlns="http://www.w3.org/1999/xhtml"', ''));
      }
    } else if (mySel.value === 'ReparseRight') {
      if (myI === 1) {
        myEditor[myI].setValue(new XMLSerializer().serializeToString(new DOMParser().parseFromString(myEditor[myI].getValue(), 'text/html')).replace(' xmlns="http://www.w3.org/1999/xhtml"', ''));
      }
    } else if (mySel.value === 'ReparseBoth') {
      myEditor[myI].setValue(new XMLSerializer().serializeToString(new DOMParser().parseFromString(myEditor[myI].getValue(), 'text/html')).replace(' xmlns="http://www.w3.org/1999/xhtml"', ''));
    } else if (mySel.value === 'ReparseLeftToRight') {
      if (myI === 0) {
        myEditor[1].setValue(new XMLSerializer().serializeToString(new DOMParser().parseFromString(myEditor[0].getValue(), 'text/html')).replace(' xmlns="http://www.w3.org/1999/xhtml"', ''));
      }
    } else if (mySel.value === 'ReparseRightToLeft') {
      if (myI === 0) {
        myEditor[0].setValue(new XMLSerializer().serializeToString(new DOMParser().parseFromString(myEditor[1].getValue(), 'text/html')).replace(' xmlns="http://www.w3.org/1999/xhtml"', ''));
      }
    } else if (mySel.value === 'insReturnLeft') {
      if (myI === 0) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(> *<)([a-z!\/])/g, '>\n<$2'));
      }
    } else if (mySel.value === 'insReturnRight') {
      if (myI === 1) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(> *<)([a-z!\/])/g, '>\n<$2'));
      }
    } else if (mySel.value === 'insReturnBoth') {
      myEditor[myI].setValue(myEditor[myI].getValue().replace(/(> *<)([a-z!\/])/g, '>\n<$2'));
    } else if (mySel.value === 'delStrLeft') {
      if (myI === 0) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(\u0022)([\S ]*?)(\u0022)/g, '$1$3'));
      }
    } else if (mySel.value === 'delStrRight') {
      if (myI === 1) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(\u0022)([\S ]*?)(\u0022)/g, '$1$3'));
      }
    } else if (mySel.value === 'delStrBoth') {
      myEditor[myI].setValue(myEditor[myI].getValue().replace(/(\u0022)([\S ]*?)(\u0022)/g, '$1$3'));
    } else if (mySel.value === 'delStyleLeft') {
      if (myI === 0) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<style\b[^>]*>)([\S\s]*?)(<\/style>)/g, '$1$3'));
      }
    } else if (mySel.value === 'delStyleRight') {
      if (myI === 1) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<style\b[^>]*>)([\S\s]*?)(<\/style>)/g, '$1$3'));
      }
    } else if (mySel.value === 'delStyleBoth') {
      myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<style\b[^>]*>)([\S\s]*?)(<\/style>)/g, '$1$3'));
    } else if (mySel.value === 'delScriptLeft') {
      if (myI === 0) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<script\b[^>]*>)([\S\s]*?)(<\/script>)/g, '$1$3'));
      }
    } else if (mySel.value === 'delScriptRight') {
      if (myI === 1) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<script\b[^>]*>)([\S\s]*?)(<\/script>)/g, '$1$3'));
      }
    } else if (mySel.value === 'delScriptBoth') {
      myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<script\b[^>]*>)([\S\s]*?)(<\/script>)/g, '$1$3'));
    } else if (mySel.value === 'delLinkHRefLeft') {
      if (myI === 0) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<link.*href=\u0022)([\S ]*?)(\u0022)/g, '$1$3'));
      }
    } else if (mySel.value === 'delLinkHRefRight') {
      if (myI === 1) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<link.*href=\u0022)([\S ]*?)(\u0022)/g, '$1$3'));
      }
    } else if (mySel.value === 'delLinkHRefBoth') {
      myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<link.*href=\u0022)([\S ]*?)(\u0022)/g, '$1$3'));
    } else if (mySel.value === 'delScriptSrcLeft') {
      if (myI === 0) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<script.*src=\u0022)([\S ]*?)(\u0022)/g, '$1$3'));
      }
    } else if (mySel.value === 'delScriptSrcRight') {
      if (myI === 1) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<script.*src=\u0022)([\S ]*?)(\u0022)/g, '$1$3'));
      }
    } else if (mySel.value === 'delScriptSrcBoth') {
      myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<script.*src=\u0022)([\S ]*?)(\u0022)/g, '$1$3'));
    } else if (mySel.value === 'delTxtNodesLeft') {
      if (myI === 0) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<([\w]*?)\b[^>]*>)([^<>][\S\s][^<>]*?)(<\/([\w]*?)>)/g, '$1$4'));
      }
    } else if (mySel.value === 'delTxtNodesRight') {
      if (myI === 1) {
        myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<([\w]*?)\b[^>]*>)([^<>][\S\s][^<>]*?)(<\/([\w]*?)>)/g, '$1$4'));
      }
    } else if (mySel.value === 'delTxtNodesBoth') {
      myEditor[myI].setValue(myEditor[myI].getValue().replace(/(<([\w]*?)\b[^>]*>)([^<>][\S\s][^<>]*?)(<\/([\w]*?)>)/g, '$1$4'));
    } else if (mySel.value === 'get_HTML_SourceCode') {
      var tmpTxtContent = myEditor[myI].getValue();
      var startHTMLSrc = tmpTxtContent.indexOf('<!-- Begin: HTML Head area -->');
      var endHTMLSrc = tmpTxtContent.indexOf('<!-- End: HTML Head area -->');
      var txtHTMLSrc = tmpTxtContent.substring(startHTMLSrc, endHTMLSrc);
      myEditor[myI].setValue(txtHTMLSrc);
    } else {
      // ignore
    }
  }
  mySel.options[0].selected = true;
}

function commandEditor(myEditorName, myCommand, myP1, myP2) {
  if ((!(myEditorName)) || (typeof myEditorName !== 'string')) return false;
  myEditorName = myEditorName.toLowerCase();
  if (myEditorName === 'css') {
    CodeMirror.commands[myCommand](editor2, myP1, myP2);
  } else if (myEditorName === 'js') {
    CodeMirror.commands[myCommand](editor3, myP1, myP2);
  } else if (myEditorName === 'json') {
    CodeMirror.commands[myCommand](editor4, myP1, myP2);
  } else if (myEditorName === 'mergeleft') {
    CodeMirror.commands[myCommand](dv.edit, myP1, myP2);
  } else if (myEditorName === 'mergeright') {
    CodeMirror.commands[myCommand](dv.rightOriginal(), myP1, myP2);
  } else if (myEditorName === 'html') {
    CodeMirror.commands[myCommand](editor1, myP1, myP2);
  }
}

function optionEditor(myEditorName, myOpt, myP1, myP2, myP3, myP4, myP5) {
  if ((!(myEditorName)) || (typeof myEditorName !== 'string')) return false;
  if ((!(myOpt)) || (typeof myOpt !== 'string')) return false;
  myEditorName = myEditorName.toLowerCase();
  if (myEditorName === 'css') {
    editor2.setOption(myOpt, myP1, myP2, myP3, myP4, myP5);
  } else if (myEditorName === 'js') {
    editor3.setOption(myOpt, myP1, myP2, myP3, myP4, myP5);
  } else if (myEditorName === 'json') {
    editor4.setOption(myOpt, myP1, myP2, myP3, myP4, myP5);
  } else if (myEditorName === 'mergeleft') {
    dv.edit.setOption(myOpt, myP1, myP2, myP3, myP4, myP5);
  } else if (myEditorName === 'mergeright') {
    dv.rightOriginal().setOption(myOpt, myP1, myP2, myP3, myP4, myP5);
  } else if (myEditorName === 'html') {
    editor1.setOption(myOpt, myP1, myP2, myP3, myP4, myP5);
  }
}

function miniEditor(myEditor) {
  myEditor.setValue(miniText(myEditor.getValue()));
}
function miniText(myTxt) {
  myTxt = myTxt.replace(/(\r\n)/g, '\n');
  myTxt = myTxt.replace(/\r/g, '\n');
  myTxt = myTxt.replace(/[\f\t\v]/g, ' ');
  myTxt = myTxt.replace(/ {2,}/g, ' ');
  myTxt = myTxt.replace(/( \n){2,}/g, '\n');
  myTxt = myTxt.replace(/\n{2,}/g, '\n');
  return myTxt;
  /* ?\a ⇒ 7 ; control-g, C-g */
  /* ?\b ⇒ 8 ; backspace, BS, C-h */
  /* ?\t ⇒ 9 ; tab, TAB, C-i */
  /* ?\n ⇒ 10 ; newline, C-j */
  /* ?\v ⇒ 11 ; vertical tab, C-k */
  /* ?\f ⇒ 12 ; formfeed character, C-l */
  /* ?\r ⇒ 13 ; carriage return, RET, C-m */
  /* ?\e ⇒ 27 ; escape character, ESC, C-[ */
  /* ?\s ⇒ 32 ; space character, SPC */
  /* ?\\ ⇒ 92 ; backslash character, \ */
  /* ?\d ⇒ 127 ; delete character, DEL */
}

function refreshEditor(myEditorName) {
  if ((!(myEditorName)) || (typeof myEditorName !== 'string')) return false;
  myEditorName = myEditorName.toLowerCase();
  if (myEditorName === 'css') {
    editor2.refresh();
  } else if (myEditorName === 'js') {
    editor3.refresh();
  } else if (myEditorName === 'json') {
    editor4.refresh();
  } else if (myEditorName === 'mergeleft') {
    dv.edit.refresh();
  } else if (myEditorName === 'mergeright') {
    dv.rightOriginal().refresh();
  } else if (myEditorName === 'html') {
    editor1.refresh();
  }
}

function selectAllEditor(myEditorName) {
  if ((!(myEditorName)) || (typeof myEditorName !== 'string')) return false;
  myEditorName = myEditorName.toLowerCase();
  if (myEditorName === 'css') {
    CodeMirror.commands["selectAll"](editor2);
  } else if (myEditorName === 'js') {
    CodeMirror.commands["selectAll"](editor3);
  } else if (myEditorName === 'json') {
    CodeMirror.commands["selectAll"](editor4);
  } else if (myEditorName === 'mergeleft') {
    CodeMirror.commands["selectAll"](dv.edit);
  } else if (myEditorName === 'mergeright') {
    CodeMirror.commands["selectAll"](dv.rightOriginal());
  } else if (myEditorName === 'html') {
    CodeMirror.commands["selectAll"](editor1);
  }
}

function formatSelection(myEditorName) {
  if ((!(myEditorName)) || (typeof myEditorName !== 'string')) return false;
  myEditorName = myEditorName.toLowerCase();
  if (myEditorName === 'css') {
    autoFormatSelection(editor2);
  } else if (myEditorName === 'js') {
    autoFormatSelection(editor3);
  } else if (myEditorName === 'json') {
    autoFormatSelection(editor4);
  } else if (myEditorName === 'mergeleft') {
    autoFormatSelection(dv.edit);
  } else if (myEditorName === 'mergeright') {
    autoFormatSelection(dv.rightOriginal());
  } else if (myEditorName === 'html') {
    autoFormatSelection(editor1);
  }
}

function formatAll(myEditorName) {
  if ((!(myEditorName)) || (typeof myEditorName !== 'string')) return false;
  myEditorName = myEditorName.toLowerCase();
  if (myEditorName === 'css') {
    autoFormatAll(editor2);
  } else if (myEditorName === 'js') {
    autoFormatAll(editor3);
  } else if (myEditorName === 'json') {
    autoFormatAll(editor4);
  } else if (myEditorName === 'mergeleft') {
    autoFormatAll(dv.edit);
  } else if (myEditorName === 'mergeright') {
    autoFormatAll(dv.rightOriginal());
  } else if (myEditorName === 'html') {
    autoFormatAll(editor1);
  }
}
</script>

</article>
</body>
</html>